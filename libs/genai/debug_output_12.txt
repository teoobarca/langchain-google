/Users/hamper/Documents/Programming/nexana/langchain-google/.venv/lib/python3.14/site-packages/langsmith/schemas.py:22: UserWarning: Core Pydantic V1 functionality isn't compatible with Python 3.14 or greater.
  from pydantic.v1 import (
============================= test session starts ==============================
platform darwin -- Python 3.14.0, pytest-9.0.1, pluggy-1.6.0
rootdir: /Users/hamper/Documents/Programming/nexana/langchain-google/libs/genai
configfile: pyproject.toml
plugins: anyio-4.11.0, langsmith-0.4.46
collected 11 items

tests/unit_tests/test_chat_models.py ....FFFFFFF

=================================== FAILURES ===================================
___________ test_parse_response_candidate[raw_candidate4-expected4] ____________

raw_candidate = {'content': {'parts': [{'function_call': FunctionCall(
  args={
    'name': 'Ben'
  },
  name='Information'
)}]}}
expected = AIMessage(content='', additional_kwargs={'function_call': {'name': 'Information', 'arguments': '{"name": "Ben"}'}}, re...s=[{'name': 'Information', 'args': {'name': 'Ben'}, 'id': '00000000-0000-0000-0000-00000000000', 'type': 'tool_call'}])

    @pytest.mark.parametrize(
        ("raw_candidate", "expected"),
        [
            (
                {"content": {"parts": [{"text": "Mike age is 30"}]}},
                AIMessage(
                    content="Mike age is 30",
                    additional_kwargs={},
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {"text": "Mike age is 30"},
                            {"text": "Arthur age is 30"},
                        ]
                    }
                },
                AIMessage(
                    content=["Mike age is 30", "Arthur age is 30"],
                    additional_kwargs={},
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "inline_data": {
                                    "mime_type": "image/bmp",
                                    "data": base64.b64decode(
                                        "Qk0eAAAAAAAAABoAAAAMAAAAAQABAAEAGAAAAP8A"
                                    ),
                                }
                            }
                        ]
                    }
                },
                AIMessage(
                    content=[
                        {
                            "type": "image_url",
                            "image_url": {
                                "url": "data:image/bmp;base64,"
                                "Qk0eAAAAAAAAABoAAAAMAAAAAQABAAEAGAAAAP8A"
                            },
                        }
                    ]
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {"text": "This is a 1x1 BMP."},
                            {
                                "inline_data": {
                                    "mime_type": "image/bmp",
                                    "data": base64.b64decode(
                                        "Qk0eAAAAAAAAABoAAAAMAAAAAQABAAEAGAAAAP8A"
                                    ),
                                }
                            },
                        ]
                    }
                },
                AIMessage(
                    content=[
                        "This is a 1x1 BMP.",
                        {
                            "type": "image_url",
                            "image_url": {
                                "url": "data:image/bmp;base64,"
                                "Qk0eAAAAAAAAABoAAAAMAAAAAQABAAEAGAAAAP8A"
                            },
                        },
                    ]
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information", args={"name": "Ben"}
                                )
                            }
                        ]
                    }
                },
                AIMessage(
                    content="",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"name": "Ben"}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"name": "Ben"},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information",
                                    args={"info": ["A", "B", "C"]},
                                )
                            }
                        ]
                    }
                },
                AIMessage(
                    content="",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"info": ["A", "B", "C"]}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"info": ["A", "B", "C"]},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information",
                                    args={
                                        "people": [
                                            {"name": "Joe", "age": 30},
                                            {"name": "Martha"},
                                        ]
                                    },
                                )
                            }
                        ]
                    }
                },
                AIMessage(
                    content="",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps(
                                {
                                    "people": [
                                        {"name": "Joe", "age": 30},
                                        {"name": "Martha"},
                                    ]
                                }
                            ),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={
                                "people": [
                                    {"name": "Joe", "age": 30},
                                    {"name": "Martha"},
                                ]
                            },
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information",
                                    args={"info": [[1, 2, 3], [4, 5, 6]]},
                                )
                            }
                        ]
                    }
                },
                AIMessage(
                    content="",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"info": [[1, 2, 3], [4, 5, 6]]}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"info": [[1, 2, 3], [4, 5, 6]]},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {"text": "Mike age is 30"},
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information", args={"name": "Ben"}
                                )
                            },
                        ]
                    }
                },
                AIMessage(
                    content="Mike age is 30",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"name": "Ben"}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"name": "Ben"},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information", args={"name": "Ben"}
                                )
                            },
                            {"text": "Mike age is 30"},
                        ]
                    }
                },
                AIMessage(
                    content="Mike age is 30",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"name": "Ben"}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"name": "Ben"},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
        ],
    )
    def test_parse_response_candidate(raw_candidate: dict, expected: AIMessage) -> None:
        with patch("langchain_google_genai.chat_models.uuid.uuid4") as uuid4:
            uuid4.return_value = "00000000-0000-0000-0000-00000000000"
            response_candidate = genai_types.Candidate.model_validate(raw_candidate)
            result = _parse_response_candidate(response_candidate)
            assert result.content == expected.content
>           assert result.tool_calls == expected.tool_calls
E           AssertionError: assert [{'args': {'n... 'tool_call'}] == [{'args': {'n... 'tool_call'}]
E             
E             At index 0 diff: {'name': 'Information', 'args': {'name': 'Ben'}, 'id': None, 'type': 'tool_call'} != {'name': 'Information', 'args': {'name': 'Ben'}, 'id': '00000000-0000-0000-0000-00000000000', 'type': 'tool_call'}
E             Use -v to get more diff

tests/unit_tests/test_chat_models.py:1187: AssertionError
___________ test_parse_response_candidate[raw_candidate5-expected5] ____________

raw_candidate = {'content': {'parts': [{'function_call': FunctionCall(
  args={
    'info': [
      'A',
      'B',
      'C',
    ]
  },
  name='Information'
)}]}}
expected = AIMessage(content='', additional_kwargs={'function_call': {'name': 'Information', 'arguments': '{"info": ["A", "B", "C...: 'Information', 'args': {'info': ['A', 'B', 'C']}, 'id': '00000000-0000-0000-0000-00000000000', 'type': 'tool_call'}])

    @pytest.mark.parametrize(
        ("raw_candidate", "expected"),
        [
            (
                {"content": {"parts": [{"text": "Mike age is 30"}]}},
                AIMessage(
                    content="Mike age is 30",
                    additional_kwargs={},
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {"text": "Mike age is 30"},
                            {"text": "Arthur age is 30"},
                        ]
                    }
                },
                AIMessage(
                    content=["Mike age is 30", "Arthur age is 30"],
                    additional_kwargs={},
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "inline_data": {
                                    "mime_type": "image/bmp",
                                    "data": base64.b64decode(
                                        "Qk0eAAAAAAAAABoAAAAMAAAAAQABAAEAGAAAAP8A"
                                    ),
                                }
                            }
                        ]
                    }
                },
                AIMessage(
                    content=[
                        {
                            "type": "image_url",
                            "image_url": {
                                "url": "data:image/bmp;base64,"
                                "Qk0eAAAAAAAAABoAAAAMAAAAAQABAAEAGAAAAP8A"
                            },
                        }
                    ]
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {"text": "This is a 1x1 BMP."},
                            {
                                "inline_data": {
                                    "mime_type": "image/bmp",
                                    "data": base64.b64decode(
                                        "Qk0eAAAAAAAAABoAAAAMAAAAAQABAAEAGAAAAP8A"
                                    ),
                                }
                            },
                        ]
                    }
                },
                AIMessage(
                    content=[
                        "This is a 1x1 BMP.",
                        {
                            "type": "image_url",
                            "image_url": {
                                "url": "data:image/bmp;base64,"
                                "Qk0eAAAAAAAAABoAAAAMAAAAAQABAAEAGAAAAP8A"
                            },
                        },
                    ]
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information", args={"name": "Ben"}
                                )
                            }
                        ]
                    }
                },
                AIMessage(
                    content="",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"name": "Ben"}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"name": "Ben"},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information",
                                    args={"info": ["A", "B", "C"]},
                                )
                            }
                        ]
                    }
                },
                AIMessage(
                    content="",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"info": ["A", "B", "C"]}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"info": ["A", "B", "C"]},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information",
                                    args={
                                        "people": [
                                            {"name": "Joe", "age": 30},
                                            {"name": "Martha"},
                                        ]
                                    },
                                )
                            }
                        ]
                    }
                },
                AIMessage(
                    content="",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps(
                                {
                                    "people": [
                                        {"name": "Joe", "age": 30},
                                        {"name": "Martha"},
                                    ]
                                }
                            ),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={
                                "people": [
                                    {"name": "Joe", "age": 30},
                                    {"name": "Martha"},
                                ]
                            },
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information",
                                    args={"info": [[1, 2, 3], [4, 5, 6]]},
                                )
                            }
                        ]
                    }
                },
                AIMessage(
                    content="",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"info": [[1, 2, 3], [4, 5, 6]]}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"info": [[1, 2, 3], [4, 5, 6]]},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {"text": "Mike age is 30"},
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information", args={"name": "Ben"}
                                )
                            },
                        ]
                    }
                },
                AIMessage(
                    content="Mike age is 30",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"name": "Ben"}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"name": "Ben"},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information", args={"name": "Ben"}
                                )
                            },
                            {"text": "Mike age is 30"},
                        ]
                    }
                },
                AIMessage(
                    content="Mike age is 30",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"name": "Ben"}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"name": "Ben"},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
        ],
    )
    def test_parse_response_candidate(raw_candidate: dict, expected: AIMessage) -> None:
        with patch("langchain_google_genai.chat_models.uuid.uuid4") as uuid4:
            uuid4.return_value = "00000000-0000-0000-0000-00000000000"
            response_candidate = genai_types.Candidate.model_validate(raw_candidate)
            result = _parse_response_candidate(response_candidate)
            assert result.content == expected.content
>           assert result.tool_calls == expected.tool_calls
E           AssertionError: assert [{'args': {'i... 'tool_call'}] == [{'args': {'i... 'tool_call'}]
E             
E             At index 0 diff: {'name': 'Information', 'args': {'info': ['A', 'B', 'C']}, 'id': None, 'type': 'tool_call'} != {'name': 'Information', 'args': {'info': ['A', 'B', 'C']}, 'id': '00000000-0000-0000-0000-00000000000', 'type': 'tool_call'}
E             Use -v to get more diff

tests/unit_tests/test_chat_models.py:1187: AssertionError
___________ test_parse_response_candidate[raw_candidate6-expected6] ____________

raw_candidate = {'content': {'parts': [{'function_call': FunctionCall(
  args={
    'people': [
      {
        'age': 30,
        'name': 'Joe'
      },
      {
        'name': 'Martha'
      },
    ]
  },
  name='Information'
)}]}}
expected = AIMessage(content='', additional_kwargs={'function_call': {'name': 'Information', 'arguments': '{"people": [{"name": "... [{'name': 'Joe', 'age': 30}, {'name': 'Martha'}]}, 'id': '00000000-0000-0000-0000-00000000000', 'type': 'tool_call'}])

    @pytest.mark.parametrize(
        ("raw_candidate", "expected"),
        [
            (
                {"content": {"parts": [{"text": "Mike age is 30"}]}},
                AIMessage(
                    content="Mike age is 30",
                    additional_kwargs={},
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {"text": "Mike age is 30"},
                            {"text": "Arthur age is 30"},
                        ]
                    }
                },
                AIMessage(
                    content=["Mike age is 30", "Arthur age is 30"],
                    additional_kwargs={},
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "inline_data": {
                                    "mime_type": "image/bmp",
                                    "data": base64.b64decode(
                                        "Qk0eAAAAAAAAABoAAAAMAAAAAQABAAEAGAAAAP8A"
                                    ),
                                }
                            }
                        ]
                    }
                },
                AIMessage(
                    content=[
                        {
                            "type": "image_url",
                            "image_url": {
                                "url": "data:image/bmp;base64,"
                                "Qk0eAAAAAAAAABoAAAAMAAAAAQABAAEAGAAAAP8A"
                            },
                        }
                    ]
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {"text": "This is a 1x1 BMP."},
                            {
                                "inline_data": {
                                    "mime_type": "image/bmp",
                                    "data": base64.b64decode(
                                        "Qk0eAAAAAAAAABoAAAAMAAAAAQABAAEAGAAAAP8A"
                                    ),
                                }
                            },
                        ]
                    }
                },
                AIMessage(
                    content=[
                        "This is a 1x1 BMP.",
                        {
                            "type": "image_url",
                            "image_url": {
                                "url": "data:image/bmp;base64,"
                                "Qk0eAAAAAAAAABoAAAAMAAAAAQABAAEAGAAAAP8A"
                            },
                        },
                    ]
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information", args={"name": "Ben"}
                                )
                            }
                        ]
                    }
                },
                AIMessage(
                    content="",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"name": "Ben"}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"name": "Ben"},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information",
                                    args={"info": ["A", "B", "C"]},
                                )
                            }
                        ]
                    }
                },
                AIMessage(
                    content="",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"info": ["A", "B", "C"]}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"info": ["A", "B", "C"]},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information",
                                    args={
                                        "people": [
                                            {"name": "Joe", "age": 30},
                                            {"name": "Martha"},
                                        ]
                                    },
                                )
                            }
                        ]
                    }
                },
                AIMessage(
                    content="",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps(
                                {
                                    "people": [
                                        {"name": "Joe", "age": 30},
                                        {"name": "Martha"},
                                    ]
                                }
                            ),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={
                                "people": [
                                    {"name": "Joe", "age": 30},
                                    {"name": "Martha"},
                                ]
                            },
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information",
                                    args={"info": [[1, 2, 3], [4, 5, 6]]},
                                )
                            }
                        ]
                    }
                },
                AIMessage(
                    content="",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"info": [[1, 2, 3], [4, 5, 6]]}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"info": [[1, 2, 3], [4, 5, 6]]},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {"text": "Mike age is 30"},
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information", args={"name": "Ben"}
                                )
                            },
                        ]
                    }
                },
                AIMessage(
                    content="Mike age is 30",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"name": "Ben"}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"name": "Ben"},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information", args={"name": "Ben"}
                                )
                            },
                            {"text": "Mike age is 30"},
                        ]
                    }
                },
                AIMessage(
                    content="Mike age is 30",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"name": "Ben"}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"name": "Ben"},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
        ],
    )
    def test_parse_response_candidate(raw_candidate: dict, expected: AIMessage) -> None:
        with patch("langchain_google_genai.chat_models.uuid.uuid4") as uuid4:
            uuid4.return_value = "00000000-0000-0000-0000-00000000000"
            response_candidate = genai_types.Candidate.model_validate(raw_candidate)
            result = _parse_response_candidate(response_candidate)
            assert result.content == expected.content
>           assert result.tool_calls == expected.tool_calls
E           AssertionError: assert [{'args': {'p... 'tool_call'}] == [{'args': {'p... 'tool_call'}]
E             
E             At index 0 diff: {'name': 'Information', 'args': {'people': [{'name': 'Joe', 'age': 30}, {'name': 'Martha'}]}, 'id': None, 'type': 'tool_call'} != {'name': 'Information', 'args': {'people': [{'name': 'Joe', 'age': 30}, {'name': 'Martha'}]}, 'id': '00000000-0000-0000-0000-00000000000', 'type': 'tool_call'}
E             Use -v to get more diff

tests/unit_tests/test_chat_models.py:1187: AssertionError
___________ test_parse_response_candidate[raw_candidate7-expected7] ____________

raw_candidate = {'content': {'parts': [{'function_call': FunctionCall(
  args={
    'info': [
      [
        1,
        2,
        3,
      ],
      [
        4,
        5,
        6,
      ],
    ]
  },
  name='Information'
)}]}}
expected = AIMessage(content='', additional_kwargs={'function_call': {'name': 'Information', 'arguments': '{"info": [[1, 2, 3], [...rmation', 'args': {'info': [[1, 2, 3], [4, 5, 6]]}, 'id': '00000000-0000-0000-0000-00000000000', 'type': 'tool_call'}])

    @pytest.mark.parametrize(
        ("raw_candidate", "expected"),
        [
            (
                {"content": {"parts": [{"text": "Mike age is 30"}]}},
                AIMessage(
                    content="Mike age is 30",
                    additional_kwargs={},
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {"text": "Mike age is 30"},
                            {"text": "Arthur age is 30"},
                        ]
                    }
                },
                AIMessage(
                    content=["Mike age is 30", "Arthur age is 30"],
                    additional_kwargs={},
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "inline_data": {
                                    "mime_type": "image/bmp",
                                    "data": base64.b64decode(
                                        "Qk0eAAAAAAAAABoAAAAMAAAAAQABAAEAGAAAAP8A"
                                    ),
                                }
                            }
                        ]
                    }
                },
                AIMessage(
                    content=[
                        {
                            "type": "image_url",
                            "image_url": {
                                "url": "data:image/bmp;base64,"
                                "Qk0eAAAAAAAAABoAAAAMAAAAAQABAAEAGAAAAP8A"
                            },
                        }
                    ]
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {"text": "This is a 1x1 BMP."},
                            {
                                "inline_data": {
                                    "mime_type": "image/bmp",
                                    "data": base64.b64decode(
                                        "Qk0eAAAAAAAAABoAAAAMAAAAAQABAAEAGAAAAP8A"
                                    ),
                                }
                            },
                        ]
                    }
                },
                AIMessage(
                    content=[
                        "This is a 1x1 BMP.",
                        {
                            "type": "image_url",
                            "image_url": {
                                "url": "data:image/bmp;base64,"
                                "Qk0eAAAAAAAAABoAAAAMAAAAAQABAAEAGAAAAP8A"
                            },
                        },
                    ]
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information", args={"name": "Ben"}
                                )
                            }
                        ]
                    }
                },
                AIMessage(
                    content="",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"name": "Ben"}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"name": "Ben"},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information",
                                    args={"info": ["A", "B", "C"]},
                                )
                            }
                        ]
                    }
                },
                AIMessage(
                    content="",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"info": ["A", "B", "C"]}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"info": ["A", "B", "C"]},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information",
                                    args={
                                        "people": [
                                            {"name": "Joe", "age": 30},
                                            {"name": "Martha"},
                                        ]
                                    },
                                )
                            }
                        ]
                    }
                },
                AIMessage(
                    content="",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps(
                                {
                                    "people": [
                                        {"name": "Joe", "age": 30},
                                        {"name": "Martha"},
                                    ]
                                }
                            ),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={
                                "people": [
                                    {"name": "Joe", "age": 30},
                                    {"name": "Martha"},
                                ]
                            },
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information",
                                    args={"info": [[1, 2, 3], [4, 5, 6]]},
                                )
                            }
                        ]
                    }
                },
                AIMessage(
                    content="",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"info": [[1, 2, 3], [4, 5, 6]]}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"info": [[1, 2, 3], [4, 5, 6]]},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {"text": "Mike age is 30"},
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information", args={"name": "Ben"}
                                )
                            },
                        ]
                    }
                },
                AIMessage(
                    content="Mike age is 30",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"name": "Ben"}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"name": "Ben"},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information", args={"name": "Ben"}
                                )
                            },
                            {"text": "Mike age is 30"},
                        ]
                    }
                },
                AIMessage(
                    content="Mike age is 30",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"name": "Ben"}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"name": "Ben"},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
        ],
    )
    def test_parse_response_candidate(raw_candidate: dict, expected: AIMessage) -> None:
        with patch("langchain_google_genai.chat_models.uuid.uuid4") as uuid4:
            uuid4.return_value = "00000000-0000-0000-0000-00000000000"
            response_candidate = genai_types.Candidate.model_validate(raw_candidate)
            result = _parse_response_candidate(response_candidate)
            assert result.content == expected.content
>           assert result.tool_calls == expected.tool_calls
E           AssertionError: assert [{'args': {'i... 'tool_call'}] == [{'args': {'i... 'tool_call'}]
E             
E             At index 0 diff: {'name': 'Information', 'args': {'info': [[1, 2, 3], [4, 5, 6]]}, 'id': None, 'type': 'tool_call'} != {'name': 'Information', 'args': {'info': [[1, 2, 3], [4, 5, 6]]}, 'id': '00000000-0000-0000-0000-00000000000', 'type': 'tool_call'}
E             Use -v to get more diff

tests/unit_tests/test_chat_models.py:1187: AssertionError
___________ test_parse_response_candidate[raw_candidate8-expected8] ____________

raw_candidate = {'content': {'parts': [{'text': 'Mike age is 30'}, {'function_call': FunctionCall(
  args={
    'name': 'Ben'
  },
  name='Information'
)}]}}
expected = AIMessage(content='Mike age is 30', additional_kwargs={'function_call': {'name': 'Information', 'arguments': '{"name":...s=[{'name': 'Information', 'args': {'name': 'Ben'}, 'id': '00000000-0000-0000-0000-00000000000', 'type': 'tool_call'}])

    @pytest.mark.parametrize(
        ("raw_candidate", "expected"),
        [
            (
                {"content": {"parts": [{"text": "Mike age is 30"}]}},
                AIMessage(
                    content="Mike age is 30",
                    additional_kwargs={},
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {"text": "Mike age is 30"},
                            {"text": "Arthur age is 30"},
                        ]
                    }
                },
                AIMessage(
                    content=["Mike age is 30", "Arthur age is 30"],
                    additional_kwargs={},
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "inline_data": {
                                    "mime_type": "image/bmp",
                                    "data": base64.b64decode(
                                        "Qk0eAAAAAAAAABoAAAAMAAAAAQABAAEAGAAAAP8A"
                                    ),
                                }
                            }
                        ]
                    }
                },
                AIMessage(
                    content=[
                        {
                            "type": "image_url",
                            "image_url": {
                                "url": "data:image/bmp;base64,"
                                "Qk0eAAAAAAAAABoAAAAMAAAAAQABAAEAGAAAAP8A"
                            },
                        }
                    ]
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {"text": "This is a 1x1 BMP."},
                            {
                                "inline_data": {
                                    "mime_type": "image/bmp",
                                    "data": base64.b64decode(
                                        "Qk0eAAAAAAAAABoAAAAMAAAAAQABAAEAGAAAAP8A"
                                    ),
                                }
                            },
                        ]
                    }
                },
                AIMessage(
                    content=[
                        "This is a 1x1 BMP.",
                        {
                            "type": "image_url",
                            "image_url": {
                                "url": "data:image/bmp;base64,"
                                "Qk0eAAAAAAAAABoAAAAMAAAAAQABAAEAGAAAAP8A"
                            },
                        },
                    ]
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information", args={"name": "Ben"}
                                )
                            }
                        ]
                    }
                },
                AIMessage(
                    content="",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"name": "Ben"}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"name": "Ben"},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information",
                                    args={"info": ["A", "B", "C"]},
                                )
                            }
                        ]
                    }
                },
                AIMessage(
                    content="",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"info": ["A", "B", "C"]}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"info": ["A", "B", "C"]},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information",
                                    args={
                                        "people": [
                                            {"name": "Joe", "age": 30},
                                            {"name": "Martha"},
                                        ]
                                    },
                                )
                            }
                        ]
                    }
                },
                AIMessage(
                    content="",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps(
                                {
                                    "people": [
                                        {"name": "Joe", "age": 30},
                                        {"name": "Martha"},
                                    ]
                                }
                            ),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={
                                "people": [
                                    {"name": "Joe", "age": 30},
                                    {"name": "Martha"},
                                ]
                            },
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information",
                                    args={"info": [[1, 2, 3], [4, 5, 6]]},
                                )
                            }
                        ]
                    }
                },
                AIMessage(
                    content="",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"info": [[1, 2, 3], [4, 5, 6]]}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"info": [[1, 2, 3], [4, 5, 6]]},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {"text": "Mike age is 30"},
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information", args={"name": "Ben"}
                                )
                            },
                        ]
                    }
                },
                AIMessage(
                    content="Mike age is 30",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"name": "Ben"}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"name": "Ben"},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information", args={"name": "Ben"}
                                )
                            },
                            {"text": "Mike age is 30"},
                        ]
                    }
                },
                AIMessage(
                    content="Mike age is 30",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"name": "Ben"}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"name": "Ben"},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
        ],
    )
    def test_parse_response_candidate(raw_candidate: dict, expected: AIMessage) -> None:
        with patch("langchain_google_genai.chat_models.uuid.uuid4") as uuid4:
            uuid4.return_value = "00000000-0000-0000-0000-00000000000"
            response_candidate = genai_types.Candidate.model_validate(raw_candidate)
            result = _parse_response_candidate(response_candidate)
            assert result.content == expected.content
>           assert result.tool_calls == expected.tool_calls
E           AssertionError: assert [{'args': {'n... 'tool_call'}] == [{'args': {'n... 'tool_call'}]
E             
E             At index 0 diff: {'name': 'Information', 'args': {'name': 'Ben'}, 'id': None, 'type': 'tool_call'} != {'name': 'Information', 'args': {'name': 'Ben'}, 'id': '00000000-0000-0000-0000-00000000000', 'type': 'tool_call'}
E             Use -v to get more diff

tests/unit_tests/test_chat_models.py:1187: AssertionError
___________ test_parse_response_candidate[raw_candidate9-expected9] ____________

raw_candidate = {'content': {'parts': [{'function_call': FunctionCall(
  args={
    'name': 'Ben'
  },
  name='Information'
)}, {'text': 'Mike age is 30'}]}}
expected = AIMessage(content='Mike age is 30', additional_kwargs={'function_call': {'name': 'Information', 'arguments': '{"name":...s=[{'name': 'Information', 'args': {'name': 'Ben'}, 'id': '00000000-0000-0000-0000-00000000000', 'type': 'tool_call'}])

    @pytest.mark.parametrize(
        ("raw_candidate", "expected"),
        [
            (
                {"content": {"parts": [{"text": "Mike age is 30"}]}},
                AIMessage(
                    content="Mike age is 30",
                    additional_kwargs={},
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {"text": "Mike age is 30"},
                            {"text": "Arthur age is 30"},
                        ]
                    }
                },
                AIMessage(
                    content=["Mike age is 30", "Arthur age is 30"],
                    additional_kwargs={},
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "inline_data": {
                                    "mime_type": "image/bmp",
                                    "data": base64.b64decode(
                                        "Qk0eAAAAAAAAABoAAAAMAAAAAQABAAEAGAAAAP8A"
                                    ),
                                }
                            }
                        ]
                    }
                },
                AIMessage(
                    content=[
                        {
                            "type": "image_url",
                            "image_url": {
                                "url": "data:image/bmp;base64,"
                                "Qk0eAAAAAAAAABoAAAAMAAAAAQABAAEAGAAAAP8A"
                            },
                        }
                    ]
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {"text": "This is a 1x1 BMP."},
                            {
                                "inline_data": {
                                    "mime_type": "image/bmp",
                                    "data": base64.b64decode(
                                        "Qk0eAAAAAAAAABoAAAAMAAAAAQABAAEAGAAAAP8A"
                                    ),
                                }
                            },
                        ]
                    }
                },
                AIMessage(
                    content=[
                        "This is a 1x1 BMP.",
                        {
                            "type": "image_url",
                            "image_url": {
                                "url": "data:image/bmp;base64,"
                                "Qk0eAAAAAAAAABoAAAAMAAAAAQABAAEAGAAAAP8A"
                            },
                        },
                    ]
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information", args={"name": "Ben"}
                                )
                            }
                        ]
                    }
                },
                AIMessage(
                    content="",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"name": "Ben"}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"name": "Ben"},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information",
                                    args={"info": ["A", "B", "C"]},
                                )
                            }
                        ]
                    }
                },
                AIMessage(
                    content="",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"info": ["A", "B", "C"]}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"info": ["A", "B", "C"]},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information",
                                    args={
                                        "people": [
                                            {"name": "Joe", "age": 30},
                                            {"name": "Martha"},
                                        ]
                                    },
                                )
                            }
                        ]
                    }
                },
                AIMessage(
                    content="",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps(
                                {
                                    "people": [
                                        {"name": "Joe", "age": 30},
                                        {"name": "Martha"},
                                    ]
                                }
                            ),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={
                                "people": [
                                    {"name": "Joe", "age": 30},
                                    {"name": "Martha"},
                                ]
                            },
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information",
                                    args={"info": [[1, 2, 3], [4, 5, 6]]},
                                )
                            }
                        ]
                    }
                },
                AIMessage(
                    content="",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"info": [[1, 2, 3], [4, 5, 6]]}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"info": [[1, 2, 3], [4, 5, 6]]},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {"text": "Mike age is 30"},
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information", args={"name": "Ben"}
                                )
                            },
                        ]
                    }
                },
                AIMessage(
                    content="Mike age is 30",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"name": "Ben"}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"name": "Ben"},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
            (
                {
                    "content": {
                        "parts": [
                            {
                                "function_call": genai_types.FunctionCall(
                                    name="Information", args={"name": "Ben"}
                                )
                            },
                            {"text": "Mike age is 30"},
                        ]
                    }
                },
                AIMessage(
                    content="Mike age is 30",
                    additional_kwargs={
                        "function_call": {
                            "name": "Information",
                            "arguments": json.dumps({"name": "Ben"}),
                        },
                    },
                    tool_calls=[
                        create_tool_call(
                            name="Information",
                            args={"name": "Ben"},
                            id="00000000-0000-0000-0000-00000000000",
                        ),
                    ],
                ),
            ),
        ],
    )
    def test_parse_response_candidate(raw_candidate: dict, expected: AIMessage) -> None:
        with patch("langchain_google_genai.chat_models.uuid.uuid4") as uuid4:
            uuid4.return_value = "00000000-0000-0000-0000-00000000000"
            response_candidate = genai_types.Candidate.model_validate(raw_candidate)
            result = _parse_response_candidate(response_candidate)
            assert result.content == expected.content
>           assert result.tool_calls == expected.tool_calls
E           AssertionError: assert [{'args': {'n... 'tool_call'}] == [{'args': {'n... 'tool_call'}]
E             
E             At index 0 diff: {'name': 'Information', 'args': {'name': 'Ben'}, 'id': None, 'type': 'tool_call'} != {'name': 'Information', 'args': {'name': 'Ben'}, 'id': '00000000-0000-0000-0000-00000000000', 'type': 'tool_call'}
E             Use -v to get more diff

tests/unit_tests/test_chat_models.py:1187: AssertionError
____________ test_parse_response_candidate_includes_model_provider _____________

    def test_parse_response_candidate_includes_model_provider() -> None:
        """Test `_parse_response_candidate` has `model_provider` in `response_metadata`."""
        raw_candidate = {
            "content": {"parts": [{"text": "Hello, world!"}]},
            "finish_reason": 1,
            "safety_ratings": [],
        }
    
>       response_candidate = genai_types.Candidate.model_validate(raw_candidate)
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       pydantic_core._pydantic_core.ValidationError: 1 validation error for Candidate
E       finish_reason
E         Input should be 'FINISH_REASON_UNSPECIFIED', 'STOP', 'MAX_TOKENS', 'SAFETY', 'RECITATION', 'LANGUAGE', 'OTHER', 'BLOCKLIST', 'PROHIBITED_CONTENT', 'SPII', 'MALFORMED_FUNCTION_CALL', 'IMAGE_SAFETY', 'UNEXPECTED_TOOL_CALL', 'IMAGE_PROHIBITED_CONTENT' or 'NO_IMAGE' [type=enum, input_value=1, input_type=int]
E           For further information visit https://errors.pydantic.dev/2.12/v/enum

tests/unit_tests/test_chat_models.py:1211: ValidationError
=============================== warnings summary ===============================
../../.venv/lib/python3.14/site-packages/_pytest/config/__init__.py:1397
  /Users/hamper/Documents/Programming/nexana/langchain-google/.venv/lib/python3.14/site-packages/_pytest/config/__init__.py:1397: PytestConfigWarning: Unknown config option: asyncio_mode
  
    self._warn_or_fail_if_strict(f"Unknown config option: {key}\n")

../../.venv/lib/python3.14/site-packages/google/genai/types.py:43
  /Users/hamper/Documents/Programming/nexana/langchain-google/.venv/lib/python3.14/site-packages/google/genai/types.py:43: DeprecationWarning: '_UnionGenericAlias' is deprecated and slated for removal in Python 3.17
    VersionedUnionType = Union[builtin_types.UnionType, _UnionGenericAlias]

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/unit_tests/test_chat_models.py::test_parse_response_candidate[raw_candidate4-expected4]
FAILED tests/unit_tests/test_chat_models.py::test_parse_response_candidate[raw_candidate5-expected5]
FAILED tests/unit_tests/test_chat_models.py::test_parse_response_candidate[raw_candidate6-expected6]
FAILED tests/unit_tests/test_chat_models.py::test_parse_response_candidate[raw_candidate7-expected7]
FAILED tests/unit_tests/test_chat_models.py::test_parse_response_candidate[raw_candidate8-expected8]
FAILED tests/unit_tests/test_chat_models.py::test_parse_response_candidate[raw_candidate9-expected9]
FAILED tests/unit_tests/test_chat_models.py::test_parse_response_candidate_includes_model_provider
=================== 7 failed, 4 passed, 2 warnings in 1.18s ====================
