/Users/hamper/Documents/Programming/nexana/langchain-google/.venv/lib/python3.14/site-packages/langsmith/schemas.py:22: UserWarning: Core Pydantic V1 functionality isn't compatible with Python 3.14 or greater.
  from pydantic.v1 import (
============================= test session starts ==============================
platform darwin -- Python 3.14.0, pytest-9.0.1, pluggy-1.6.0
rootdir: /Users/hamper/Documents/Programming/nexana/langchain-google/libs/genai
configfile: pyproject.toml
plugins: anyio-4.11.0, langsmith-0.4.46
collected 1 item

tests/unit_tests/test_chat_models.py DEBUG: part=media_resolution=None code_execution_result=None executable_code=None file_data=None function_call=None function_response=None inline_data=None text='Meow!' thought=None thought_signature=None video_metadata=None, type=<class 'google.genai.types.Part'>
DEBUG: part=media_resolution=None code_execution_result=None executable_code=None file_data=None function_call=None function_response=None inline_data=Blob(
  data=b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x00\x01\x00\x00\x00\x01\x08\x06\x00\x00\x00\x1f\x15\xc4\x89\x00\x00\x00\rIDATx\xdacd`\xf8_\x0f\x00\x02\x87\x01\x80\xebG\xba\x92\x00\x00\x00\x00IEND\xaeB`\x82',
  mime_type='image/png'
) text=None thought=None thought_signature=None video_metadata=None, type=<class 'google.genai.types.Part'>
F

=================================== FAILURES ===================================
_________________ test_chat_google_genai_image_content_blocks __________________

    def test_chat_google_genai_image_content_blocks() -> None:
        """Test generating an image with mocked response and `content_blocks`
        translation."""
        mock_response = GenerateContentResponse.model_validate(
            {
                "candidates": [
                    {
                        "content": {
                            "parts": [
                                {"text": "Meow!"},
                                {
                                    "inline_data": {
                                        "mime_type": "image/png",
                                        "data": base64.b64decode(
                                            "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAf"
                                            "FcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg=="
                                        ),
                                    }
                                },
                            ]
                        },
                        "finish_reason": "STOP",
                    }
                ],
                "usage_metadata": {
                    "prompt_token_count": 10,
                    "candidates_token_count": 5,
                    "total_token_count": 15,
                },
            }
        )
    
        llm = ChatGoogleGenerativeAI(
            model=MODEL_NAME,
            google_api_key=SecretStr(FAKE_API_KEY),
        )
    
        with patch.object(llm.client.models, "generate_content", return_value=mock_response):
            result = llm.invoke(
                "Say 'meow!' and then Generate an image of a cat.",
                generation_config={
                    "top_k": 2,
                    "top_p": 1,
                    "temperature": 0.7,
                    "response_modalities": ["TEXT", "IMAGE"],
                },
            )
    
        assert isinstance(result, AIMessage)
        assert isinstance(result.content, list)
        assert isinstance(result.content[0], str)
        assert isinstance(result.content[1], dict)
        assert result.content[1].get("type") == "image_url"
        assert not result.content[0].startswith(" ")
    
        content_blocks = result.content_blocks
        assert len(content_blocks) == 2
    
        text_block = content_blocks[0]
        assert text_block["type"] == "text"
        assert isinstance(text_block["text"], str)
    
        image_block = content_blocks[1]
        assert isinstance(image_block, dict)
        assert image_block["type"] == "image"
        assert "base64" in image_block
        assert "mime_type" in image_block
        assert image_block["mime_type"] == "image/png"
        assert image_block["base64"] == (
            "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDw"
            "AChwGA60e6kgAAAABJRU5ErkJggg=="
        )
    
        # Pre-v1 we returned images using chat completions format. This translation logic
        # is already covered by unit tests in langchain core, but we add a simple test here
        # to ensure our translator function is wired up correctly
        image_blocks_v1 = _convert_to_v1_from_genai(result)
        assert len(image_blocks_v1) == 2
        assert image_blocks_v1[0] == text_block
>       assert image_blocks_v1[1] == image_block
E       AssertionError: assert {'base64': 'i...ype': 'image'} == {'base64': 'i...ype': 'image'}
E         
E         Omitting 3 identical items, use -vv to show
E         Right contains 1 more item:
E         {'id': 'lc_8a935683-9bc6-407f-8bad-f5cd07f9aa9d'}
E         Use -v to get more diff

tests/unit_tests/test_chat_models.py:2171: AssertionError
=============================== warnings summary ===============================
../../.venv/lib/python3.14/site-packages/_pytest/config/__init__.py:1397
  /Users/hamper/Documents/Programming/nexana/langchain-google/.venv/lib/python3.14/site-packages/_pytest/config/__init__.py:1397: PytestConfigWarning: Unknown config option: asyncio_mode
  
    self._warn_or_fail_if_strict(f"Unknown config option: {key}\n")

../../.venv/lib/python3.14/site-packages/google/genai/types.py:43
  /Users/hamper/Documents/Programming/nexana/langchain-google/.venv/lib/python3.14/site-packages/google/genai/types.py:43: DeprecationWarning: '_UnionGenericAlias' is deprecated and slated for removal in Python 3.17
    VersionedUnionType = Union[builtin_types.UnionType, _UnionGenericAlias]

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/unit_tests/test_chat_models.py::test_chat_google_genai_image_content_blocks
======================== 1 failed, 2 warnings in 1.47s =========================
